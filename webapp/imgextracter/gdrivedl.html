<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDrive Direct Download Link Generator | Stadia</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0e0e0e; /* Deep dark background */
            color: #d1d5db;
        }
        /* Style for the main container card */
        .tool-card {
            background-color: #1a1a1a;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 2rem;
            max-width: 600px;
            width: 100%;
        }
        /* Style for inputs */
        input[type="url"], input[type="text"] {
            background-color: #2a2a2a;
            border: 1px solid #444;
            color: #f1f1f1;
            transition: all 0.2s;
        }
        input[type="url"]:focus, input[type="text"]:focus {
            border-color: #6366f1; /* Indigo accent */
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5);
        }
        /* Mobile menu backdrop styles */
        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 40;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        .backdrop.visible {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="flex min-h-screen">
    
    <!-- Mobile Menu Button -->
    <button id="menu-button" class="sm:hidden fixed top-4 left-4 z-50 p-2 rounded-lg text-gray-800 bg-white shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
        </svg>
    </button>

    <!-- Side Navigation Bar -->
    <nav id="side-navbar" class="fixed top-0 left-0 bottom-0 w-64 bg-[#111] text-white p-6 shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out sm:translate-x-0">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-bold">IMG Extracter</h2>
            <button id="close-menu-button" class="sm:hidden text-gray-400 hover:text-white focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <ul class="space-y-4">
            <li>
                <a href="index.html" id="home-link" class="block p-3 rounded-lg hover:bg-[#333] transition-colors duration-200">
                    Dashboard
                </a>
            </li>
            <li>
                <a href="more-tools.html" id="more-tools-link" class="block p-3 rounded-lg hover:bg-[#333] transition-colors duration-200">
                    Tool Panel
                </a>
            </li>
            <li>
                <a href="settings.html" id="settings-link" class="block p-3 rounded-lg hover:bg-[#333] transition-colors duration-200">
                    Settings
                </a>
            </li>
            <li>
                <a href="https://stadiastudios.github.io/stadia" rel="noopener noreferrer" class="block p-3 rounded-lg hover:bg-[#333] transition-colors duration-200">
                    StadiaStudios
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content Area -->
    <div id="main-content" class="flex-grow flex items-center justify-center p-4 transition-all duration-300 ease-in-out sm:ml-64">
        
        <!-- Tool Card -->
        <div class="tool-card text-center">
            <header class="mb-8">
                <h1 class="text-3xl md:text-4xl font-extrabold text-[#6366f1] mb-3">Google Drive Direct Link Generator</h1>
                <p class="text-lg text-gray-400">Convert any shared file link into a direct, force-download URL.</p>
            </header>

            <!-- Input Section -->
            <div class="mb-6 text-left">
                <label for="shareUrl" class="block text-sm font-medium mb-2 text-indigo-400">
                    Google Drive Share URL
                </label>
                <input
                    type="url"
                    id="shareUrl"
                    placeholder="e.g., https://drive.google.com/file/d/FILE_ID/view?usp=sharing"
                    class="w-full p-3 rounded-xl focus:outline-none text-base"
                />
            </div>

            <!-- Button -->
            <button
                id="generateButton"
                class="w-full inline-flex items-center justify-center px-4 py-3 bg-indigo-600 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50"
            >
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                Generate Direct Link
            </button>

            <!-- Result Box (Hidden by default) -->
            <div id="resultBox" class="mt-8 hidden text-left">
                <h2 class="text-xl font-semibold mb-3 text-green-400">Direct Download Link:</h2>
                
                <!-- Generated Link Display -->
                <div class="relative mb-4">
                    <input
                        id="directLinkInput"
                        readonly
                        class="w-full p-3 pr-12 rounded-xl bg-[#2a2a2a] text-green-300 border border-green-600 font-mono text-sm overflow-x-scroll"
                        value=""
                    />
                    <button
                        id="copyButton"
                        title="Copy to Clipboard"
                        class="absolute right-0 top-0 h-full p-3 text-gray-400 hover:text-white rounded-r-xl transition"
                    >
                        <!-- Copy Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Message Box -->
            <div id="messageBox" class="mt-6 p-3 rounded-lg text-sm hidden" role="alert">
                <!-- Message content will be inserted here -->
            </div>
        </div>

    </div>

    <!-- Mobile menu backdrop -->
    <div id="backdrop" class="backdrop"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation elements
            const menuButton = document.getElementById('menu-button');
            const closeMenuButton = document.getElementById('close-menu-button');
            const sideNavbar = document.getElementById('side-navbar');
            const backdrop = document.getElementById('backdrop');

            // Tool elements
            const shareUrlInput = document.getElementById('shareUrl');
            const generateButton = document.getElementById('generateButton');
            const resultBox = document.getElementById('resultBox');
            const directLinkInput = document.getElementById('directLinkInput');
            const copyButton = document.getElementById('copyButton');
            const messageBox = document.getElementById('messageBox');

            // --- Utility Functions ---

            /**
             * Shows a user message in the dedicated message box.
             * @param {string} message - The message text.
             * @param {string} type - 'success' or 'error'.
             */
            function showMessage(message, type) {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden', 'bg-red-900/30', 'text-red-300', 'bg-green-900/30', 'text-green-300');
                if (type === 'error') {
                    messageBox.classList.add('bg-red-900/30', 'text-red-300');
                } else {
                    messageBox.classList.add('bg-green-900/30', 'text-green-300');
                }
                // Show message immediately
                messageBox.classList.remove('hidden');

                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 5000);
            }

            /**
             * Extracts the File ID from various Google Drive share URL formats.
             * @param {string} url - The user-provided URL.
             * @returns {string|null} The extracted file ID or null if not found.
             */
            function extractFileId(url) {
                if (!url) return null;

                // 1. Matches /file/d/FILE_ID/view... (most common share link)
                let match1 = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)\//);
                if (match1 && match1[1]) return match1[1];

                // 2. Matches ?id=FILE_ID or &id=FILE_ID (old 'open' or 'uc' format)
                let match2 = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
                if (match2 && match2[1]) return match2[1];

                // 3. Matches if the user pastes just the ID
                if (url.length > 20 && !url.includes('/')) {
                    // Check if it matches a standard GDrive ID pattern
                    return url.match(/^[a-zA-Z0-9_-]+$/) ? url : null;
                }

                return null;
            }

            /**
             * Generates the direct download link using the extracted file ID.
             * @param {string} fileId - The Google Drive file ID.
             * @returns {string} The direct download URL.
             */
            function generateDirectLink(fileId) {
                return `https://drive.google.com/uc?export=download&id=${fileId}`;
            }

            // --- Main Tool Logic ---
            
            generateButton.addEventListener('click', () => {
                const shareUrl = shareUrlInput.value.trim();
                
                if (!shareUrl) {
                    showMessage('Please enter a Google Drive share URL.', 'error');
                    resultBox.classList.add('hidden');
                    return;
                }

                const fileId = extractFileId(shareUrl);

                if (fileId) {
                    const directLink = generateDirectLink(fileId);
                    
                    directLinkInput.value = directLink;
                    resultBox.classList.remove('hidden');
                    showMessage('Direct download link generated successfully!', 'success');
                } else {
                    showMessage('Could not find a valid File ID in the provided URL. Please ensure it is a valid Google Drive file share link.', 'error');
                    resultBox.classList.add('hidden');
                }
            });

            copyButton.addEventListener('click', () => {
                const linkToCopy = directLinkInput.value;
                if (!linkToCopy) {
                    showMessage('Nothing to copy. Please generate a link first.', 'error');
                    return;
                }

                // Copy functionality using fallback for cross-browser/iframe compatibility
                try {
                    directLinkInput.select();
                    document.execCommand('copy');
                    showMessage('Link copied to clipboard!', 'success');
                } catch (err) {
                    showMessage('Failed to copy. Please copy the link manually.', 'error');
                    console.error('Copy failed:', err);
                }
            });

            // --- Navigation Logic ---
            const toggleMenu = (open) => {
                if (open) {
                    sideNavbar.classList.remove('-translate-x-full');
                    backdrop.classList.add('visible');
                    document.body.style.overflow = 'hidden';
                } else {
                    sideNavbar.classList.add('-translate-x-full');
                    backdrop.classList.remove('visible');
                    document.body.style.overflow = '';
                }
            };

            // Event Listeners for Navigation
            menuButton.addEventListener('click', () => toggleMenu(true));
            closeMenuButton.addEventListener('click', () => toggleMenu(false));
            backdrop.addEventListener('click', () => toggleMenu(false));
            
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 640) { // Tailwind's 'sm' breakpoint
                    toggleMenu(false);
                }
            });
        });
    </script>
</body>
</html>